<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊåÅ‰ªìËØ¶ÊÉÖ - DeepAlpha</title>
    <link rel="stylesheet" href="/static/css/notion.css">
    <link rel="stylesheet" href="/static/css/admin.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="app" class="notion-page">
        <!-- ÂØºËà™ -->
        <nav class="notion-nav">
            <a href="/desk" class="notion-nav-item">Â∑•‰ΩúÂè∞</a>
            <a href="/decisions" class="notion-nav-item">ËìùÁöÆ‰π¶</a>
            <a href="/positions" class="notion-nav-item active">Á∫¢ÁöÆ‰π¶</a>
            <a href="/monitoring" class="notion-nav-item">ÁõëÊéß</a>
        </nav>

        <!-- ËøîÂõûÊåâÈíÆ -->
        <div class="back-button" style="margin-bottom: 1rem;">
            <a href="/positions" class="notion-button notion-button-ghost">
                ‚Üê ËøîÂõûÊåÅ‰ªìÂàóË°®
            </a>
        </div>

        <!-- ÊåÅ‰ªìËØ¶ÊÉÖ -->
        <div v-if="position" class="position-detail">
            <!-- Âü∫Êú¨‰ø°ÊÅØÂç°Áâá -->
            <div class="detail-header notion-card notion-fade-in">
                <div class="header-top">
                    <div class="position-title">
                        <h1>{{ position.symbol }}</h1>
                        <span class="side" :class="position.side">
                            {{ position.side === 'long' ? 'Â§öÂ§¥' : 'Á©∫Â§¥' }}
                        </span>
                    </div>
                    <div class="position-meta">
                        <div>ÊåÅ‰ªìID: <code>{{ position.id }}</code></div>
                        <div>ÂºÄ‰ªìÊó∂Èó¥: {{ formatDateTime(position.open_time) }}</div>
                    </div>
                </div>

                <!-- Áõà‰∫è‰ø°ÊÅØ -->
                <div class="pnl-summary">
                    <div class="pnl-item">
                        <label>Êú™ÂÆûÁé∞Áõà‰∫è</label>
                        <div class="value" :class="position.unrealized_pnl >= 0 ? 'positive' : 'negative'">
                            {{ formatCurrency(position.unrealized_pnl) }}
                        </div>
                    </div>
                    <div class="pnl-item">
                        <label>Êî∂ÁõäÁéá</label>
                        <div class="value" :class="position.unrealized_percent >= 0 ? 'positive' : 'negative'">
                            {{ position.unrealized_percent >= 0 ? '+' : '' }}{{ position.unrealized_percent.toFixed(2) }}%
                        </div>
                    </div>
                </div>
            </div>

            <!-- ËØ¶ÁªÜÊåáÊ†á -->
            <div class="detail-grid notion-fade-in">
                <!-- ‰ªì‰Ωç‰ø°ÊÅØ -->
                <div class="notion-card">
                    <h2>‰ªì‰Ωç‰ø°ÊÅØ</h2>
                    <div class="param-grid">
                        <div class="param">
                            <label>‰ªì‰ΩçÂ§ßÂ∞è</label>
                            <div class="value">{{ position.size }} {{ position.symbol.split('/')[1] }}</div>
                        </div>
                        <div class="param">
                            <label>Êù†ÊùÜ</label>
                            <div class="value">{{ position.leverage }}x</div>
                        </div>
                        <div class="param">
                            <label>‰øùËØÅÈáë</label>
                            <div class="value">{{ formatCurrency(position.margin) }}</div>
                        </div>
                        <div class="param">
                            <label>‰øùËØÅÈáëÁéá</label>
                            <div class="value" :class="getMarginClass(position.margin_ratio)">
                                {{ (position.margin_ratio * 100).toFixed(2) }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰ª∑Ê†º‰ø°ÊÅØ -->
                <div class="notion-card">
                    <h2>‰ª∑Ê†º‰ø°ÊÅØ</h2>
                    <div class="param-grid">
                        <div class="param">
                            <label>ÂºÄ‰ªì‰ª∑Ê†º</label>
                            <div class="value">{{ formatPrice(position.entry_price) }}</div>
                        </div>
                        <div class="param">
                            <label>Ê†áËÆ∞‰ª∑Ê†º</label>
                            <div class="value">{{ formatPrice(position.mark_price) }}</div>
                        </div>
                        <div class="param">
                            <label>Âº∫Âπ≥‰ª∑Ê†º</label>
                            <div class="value danger">{{ formatPrice(position.liquidation_price) }}</div>
                        </div>
                        <div class="param">
                            <label>Ê≠¢Êçü‰ª∑Ê†º</label>
                            <div class="value">{{ formatPrice(position.stop_loss) }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Â±ÇÁ∫ßÁÆ°ÁêÜ -->
            <div v-if="position.tiers && position.tiers.length" class="tiers-section notion-card notion-fade-in">
                <h2>Â±ÇÁ∫ßÊ≠¢ÁõàÁÆ°ÁêÜ</h2>
                <div class="tiers-visual">
                    <div
                        v-for="(tier, index) in position.tiers"
                        :key="index"
                        class="tier-item"
                        :class="{
                            done: tier.done,
                            current: isCurrentTier(tier, index)
                        }"
                    >
                        <div class="tier-header">
                            <div class="tier-number">Á¨¨ {{ index + 1 }} Â±Ç</div>
                            <div class="tier-status">
                                <span v-if="tier.done" class="notion-badge notion-badge-success">Â∑≤ÊâßË°å</span>
                                <span v-else-if="isCurrentTier(tier, index)" class="notion-badge notion-badge-warning">ÂΩìÂâç</span>
                                <span v-else class="notion-badge notion-badge-default">Á≠âÂæÖ</span>
                            </div>
                        </div>
                        <div class="tier-target">
                            <label>ÁõÆÊ†á‰ª∑Ê†º</label>
                            <div class="value">{{ formatPrice(tier.target_price) }}</div>
                        </div>
                        <div class="tier-ratio">
                            <label>Âπ≥‰ªìÊØî‰æã</label>
                            <div class="value">{{ (tier.ratio * 100).toFixed(0) }}%</div>
                        </div>
                        <div class="tier-progress" v-if="!tier.done">
                            <label>Ë∑ùÁ¶ªÁõÆÊ†á</label>
                            <div class="progress-bar">
                                <div
                                    class="progress-fill"
                                    :style="{ width: calculateTierProgress(tier) + '%' }"
                                ></div>
                            </div>
                            <div class="progress-text">
                                {{ calculateTierProgress(tier).toFixed(1) }}%
                            </div>
                        </div>
                        <div class="tier-execute-time" v-if="tier.executed_at">
                            <label>ÊâßË°åÊó∂Èó¥</label>
                            <div class="value">{{ formatDateTime(tier.executed_at) }}</div>
                        </div>
                    </div>
                </div>

                <!-- Âø´ÈÄüÊìç‰Ωú -->
                <div class="tier-actions" v-if="hasPendingTiers">
                    <button @click="adjustTiers" class="notion-button notion-button-primary">
                        Ë∞ÉÊï¥Â±ÇÁ∫ß
                    </button>
                    <button @click="closePosition" class="notion-button notion-button-secondary">
                        ÂÖ®ÈÉ®Âπ≥‰ªì
                    </button>
                </div>
            </div>

            <!-- ‰ª∑Ê†ºËµ∞ÂäøÂõæ -->
            <div class="chart-section notion-card notion-fade-in">
                <h2>‰ª∑Ê†ºËµ∞Âäø‰∏éÁõà‰∫è</h2>
                <div class="chart-controls">
                    <select v-model="chartTimeframe" @change="updateChart" class="notion-input">
                        <option value="1m">1ÂàÜÈíü</option>
                        <option value="5m">5ÂàÜÈíü</option>
                        <option value="15m">15ÂàÜÈíü</option>
                        <option value="1h">1Â∞èÊó∂</option>
                        <option value="4h">4Â∞èÊó∂</option>
                        <option value="1d">Êó•Á∫ø</option>
                    </select>
                </div>
                <div id="price-chart"></div>
            </div>

            <!-- ÂéÜÂè≤ËÆ¢Âçï -->
            <div class="orders-section notion-card notion-fade-in">
                <h2>‰∫§ÊòìÂéÜÂè≤</h2>
                <div class="orders-table">
                    <table class="notion-table">
                        <thead>
                            <tr>
                                <th>Êó∂Èó¥</th>
                                <th>Á±ªÂûã</th>
                                <th>ÊñπÂêë</th>
                                <th>Êï∞Èáè</th>
                                <th>‰ª∑Ê†º</th>
                                <th>Êàê‰∫§ÈáëÈ¢ù</th>
                                <th>ÊâãÁª≠Ë¥π</th>
                                <th>Áõà‰∫è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="trade in position.trades" :key="trade.id">
                                <td>{{ formatDateTime(trade.time) }}</td>
                                <td>{{ trade.type }}</td>
                                <td>
                                    <span class="side" :class="trade.side">
                                        {{ trade.side === 'buy' ? '‰π∞ÂÖ•' : 'ÂçñÂá∫' }}
                                    </span>
                                </td>
                                <td>{{ trade.amount }}</td>
                                <td>{{ formatPrice(trade.price) }}</td>
                                <td>{{ formatCurrency(trade.value) }}</td>
                                <td>{{ formatCurrency(trade.fee) }}</td>
                                <td :class="trade.pnl >= 0 ? 'positive' : 'negative'">
                                    {{ trade.pnl ? formatCurrency(trade.pnl) : '-' }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- È£éÈô©ÂàÜÊûê -->
            <div class="risk-analysis notion-card notion-fade-in">
                <h2>È£éÈô©ÂàÜÊûê</h2>
                <div class="risk-metrics">
                    <div class="risk-item">
                        <div class="risk-label">
                            <span>‰ª∑Ê†ºË∑ùÁ¶ªÂº∫Âπ≥</span>
                            <div class="risk-hint" data-tooltip="ÂΩìÂâç‰ª∑Ê†ºË∑ùÁ¶ªÂº∫Âπ≥‰ª∑Ê†ºÁöÑÁôæÂàÜÊØî">
                                <i>‚ìò</i>
                            </div>
                        </div>
                        <div class="risk-value" :class="getLiquidationRiskClass()">
                            {{ calculateLiquidationDistance() }}%
                        </div>
                        <div class="risk-bar">
                            <div
                                class="risk-fill"
                                :class="getLiquidationRiskClass()"
                                :style="{ width: calculateLiquidationDistance() + '%' }"
                            ></div>
                        </div>
                    </div>

                    <div class="risk-item">
                        <div class="risk-label">
                            <span>‰ªì‰ΩçÈ£éÈô©Á≠âÁ∫ß</span>
                            <div class="risk-hint" data-tooltip="Âü∫‰∫é‰ªì‰ΩçÂ§ßÂ∞èÂíåÊù†ÊùÜÁöÑÈ£éÈô©ËØÑÁ∫ß">
                                <i>‚ìò</i>
                            </div>
                        </div>
                        <div class="risk-value" :class="getPositionRiskClass()">
                            {{ getPositionRiskLevel() }}
                        </div>
                    </div>

                    <div class="risk-item">
                        <div class="risk-label">
                            <span>ÊúÄÂ§ßÂõûÊí§</span>
                            <div class="risk-hint" data-tooltip="ÊåÅ‰ªì‰ª•Êù•ÁöÑÊúÄÂ§ß‰∫èÊçüÁôæÂàÜÊØî">
                                <i>‚ìò</i>
                            </div>
                        </div>
                        <div class="risk-value negative">
                            {{ position.max_drawdown ? position.max_drawdown.toFixed(2) + '%' : 'N/A' }}
                        </div>
                    </div>
                </div>

                <div class="risk-recommendations" v-if="riskRecommendations.length">
                    <h3>È£éÈô©ÊèêÁ§∫</h3>
                    <div class="recommendations">
                        <div
                            v-for="(rec, index) in riskRecommendations"
                            :key="index"
                            class="notion-callout"
                            :class="rec.type"
                        >
                            {{ rec.message }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
        <div v-else class="loading">
            <div class="notion-spinner"></div>
            <p>Âä†ËΩΩÊåÅ‰ªìËØ¶ÊÉÖ‰∏≠...</p>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    positionId: null,
                    position: null,
                    chartTimeframe: '1h',
                    riskRecommendations: []
                };
            },
            methods: {
                async loadPosition() {
                    try {
                        const response = await fetch(`/api/live/positions/${this.positionId}`);
                        const data = await response.json();
                        this.position = data.position;

                        // Ê∏≤ÊüìÂõæË°®
                        this.renderChart();

                        // ÂàÜÊûêÈ£éÈô©
                        this.analyzeRisk();
                    } catch (error) {
                        console.error('Âä†ËΩΩÊåÅ‰ªìÂ§±Ë¥•:', error);
                    }
                },
                renderChart() {
                    // Ê®°ÊãüÊï∞ÊçÆÔºåÂÆûÈôÖÂ∫î‰ªéAPIËé∑Âèñ
                    const prices = Array.from({ length: 100 }, (_, i) => {
                        const base = this.position.entry_price;
                        const variation = Math.sin(i * 0.1) * 0.02 * base;
                        return base + variation;
                    });

                    const trace = {
                        x: Array.from({ length: 100 }, (_, i) => i),
                        y: prices,
                        type: 'scatter',
                        mode: 'lines',
                        name: '‰ª∑Ê†º',
                        line: { color: '#1971c2' }
                    };

                    // Ê∑ªÂä†ÂºÄ‰ªì‰ª∑Ê†ºÁ∫ø
                    const entryLine = {
                        x: [0, 99],
                        y: [this.position.entry_price, this.position.entry_price],
                        type: 'scatter',
                        mode: 'lines',
                        name: 'ÂºÄ‰ªì‰ª∑',
                        line: { color: '#f08c00', dash: 'dash' }
                    };

                    // Ê∑ªÂä†Âº∫Âπ≥‰ª∑Ê†ºÁ∫ø
                    const liquidationLine = {
                        x: [0, 99],
                        y: [this.position.liquidation_price, this.position.liquidation_price],
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Âº∫Âπ≥‰ª∑',
                        line: { color: '#e03131', dash: 'dash' }
                    };

                    const layout = {
                        title: `${this.position.symbol} ‰ª∑Ê†ºËµ∞Âäø`,
                        xaxis: { title: 'Êó∂Èó¥' },
                        yaxis: { title: '‰ª∑Ê†º' },
                        paper_bgcolor: 'var(--notion-background)',
                        plot_bgcolor: 'var(--notion-background)',
                        font: { color: 'var(--notion-text)' },
                        showlegend: true
                    };

                    Plotly.newPlot('price-chart', [trace, entryLine, liquidationLine], layout);
                },
                updateChart() {
                    this.renderChart();
                },
                analyzeRisk() {
                    this.riskRecommendations = [];

                    // Ê£ÄÊü•Âº∫Âπ≥È£éÈô©
                    const liquidationDistance = this.calculateLiquidationDistance();
                    if (liquidationDistance < 10) {
                        this.riskRecommendations.push({
                            type: 'notion-callout-danger',
                            message: '‚ö†Ô∏è Ë∑ùÁ¶ªÂº∫Âπ≥‰ª∑Ê†ºËøáËøëÔºåÂª∫ËÆÆÁ´ãÂç≥Âáè‰ªìÊàñËøΩÂä†‰øùËØÅÈáë'
                        });
                    } else if (liquidationDistance < 20) {
                        this.riskRecommendations.push({
                            type: 'notion-callout-warning',
                            message: '‚ö†Ô∏è ‰ª∑Ê†ºÊé•ËøëÂº∫Âπ≥‰ª∑Ê†ºÔºåËØ∑Ê≥®ÊÑèÈ£éÈô©ÊéßÂà∂'
                        });
                    }

                    // Ê£ÄÊü•‰ªì‰ΩçÂ§ßÂ∞è
                    const positionRisk = this.getPositionRiskLevel();
                    if (positionRisk === 'È´òÈ£éÈô©') {
                        this.riskRecommendations.push({
                            type: 'notion-callout-warning',
                            message: '‚ö†Ô∏è ‰ªì‰ΩçËøáÂ§ßÔºåÂª∫ËÆÆÈôç‰Ωé‰ªì‰ΩçÊàñÊù†ÊùÜ'
                        });
                    }

                    // Ê£ÄÊü•Êú™ÂÆûÁé∞‰∫èÊçü
                    if (this.position.unrealized_percent < -10) {
                        this.riskRecommendations.push({
                            type: 'notion-callout-info',
                            message: 'üí° ÂΩìÂâçÊµÆ‰∫èËæÉÂ§ßÔºåËÄÉËôëÊòØÂê¶ÈúÄË¶ÅÊ≠¢Êçü'
                        });
                    }
                },
                calculateLiquidationDistance() {
                    const current = this.position.mark_price;
                    const liquidation = this.position.liquidation_price;
                    const entry = this.position.entry_price;

                    if (this.position.side === 'long') {
                        return ((current - liquidation) / (entry - liquidation) * 100);
                    } else {
                        return ((liquidation - current) / (liquidation - entry) * 100);
                    }
                },
                getLiquidationRiskClass() {
                    const distance = this.calculateLiquidationDistance();
                    if (distance < 10) return 'danger';
                    if (distance < 30) return 'warning';
                    return 'safe';
                },
                getPositionRiskLevel() {
                    const leverage = this.position.leverage;
                    const marginRatio = this.position.margin_ratio;

                    if (leverage >= 10 || marginRatio < 0.1) return 'È´òÈ£éÈô©';
                    if (leverage >= 5 || marginRatio < 0.2) return '‰∏≠È£éÈô©';
                    return '‰ΩéÈ£éÈô©';
                },
                getPositionRiskClass() {
                    const level = this.getPositionRiskLevel();
                    if (level === 'È´òÈ£éÈô©') return 'danger';
                    if (level === '‰∏≠È£éÈô©') return 'warning';
                    return 'safe';
                },
                isCurrentTier(tier, index) {
                    if (tier.done) return false;
                    if (index === 0) return true;

                    // Ê£ÄÊü•‰∏ä‰∏ÄÂ±ÇÊòØÂê¶Â∑≤ÊâßË°å
                    const previousTier = this.position.tiers[index - 1];
                    return previousTier && previousTier.done;
                },
                hasPendingTiers() {
                    return this.position.tiers && this.position.tiers.some(t => !t.done);
                },
                calculateTierProgress(tier) {
                    const entry = this.position.entry_price;
                    const current = this.position.mark_price;
                    const target = tier.target_price;

                    if (this.position.side === 'long') {
                        return Math.max(0, Math.min(100, ((current - entry) / (target - entry)) * 100));
                    } else {
                        return Math.max(0, Math.min(100, ((entry - current) / (entry - target)) * 100));
                    }
                },
                formatCurrency(value) {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD'
                    }).format(value);
                },
                formatPrice(value) {
                    return new Intl.NumberFormat('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 6
                    }).format(value);
                },
                formatDateTime(dateStr) {
                    return new Date(dateStr).toLocaleString('zh-CN');
                },
                getMarginClass(ratio) {
                    if (ratio < 0.1) return 'danger';
                    if (ratio < 0.3) return 'warning';
                    return 'safe';
                },
                adjustTiers() {
                    // ÂÆûÁé∞Ë∞ÉÊï¥Â±ÇÁ∫ßÈÄªËæë
                    alert('Ë∞ÉÊï¥Â±ÇÁ∫ßÂäüËÉΩÂæÖÂÆûÁé∞');
                },
                closePosition() {
                    // ÂÆûÁé∞ÂÖ®ÈÉ®Âπ≥‰ªìÈÄªËæë
                    if (confirm('Á°ÆÂÆöË¶ÅÂÖ®ÈÉ®Âπ≥‰ªìÂêóÔºü')) {
                        alert('Âπ≥‰ªìÂäüËÉΩÂæÖÂÆûÁé∞');
                    }
                }
            },
            mounted() {
                // ‰ªéURLËé∑ÂèñÊåÅ‰ªìID
                const pathParts = window.location.pathname.split('/');
                this.positionId = pathParts[pathParts.length - 1];

                if (this.positionId) {
                    this.loadPosition();
                }
            }
        }).mount('#app');
    </script>

    <style>
        .position-detail {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .detail-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .position-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .position-title h1 {
            margin: 0;
        }

        .position-meta {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            color: var(--notion-text-light);
            font-size: 0.875rem;
        }

        .pnl-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            background-color: var(--notion-background-gray);
            border-radius: 0.375rem;
        }

        .pnl-item {
            text-align: center;
        }

        .pnl-item label {
            display: block;
            font-size: 0.875rem;
            color: var(--notion-text-light);
            margin-bottom: 0.5rem;
        }

        .pnl-item .value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .param-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .param {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .param label {
            font-size: 0.875rem;
            color: var(--notion-text-light);
        }

        .param .value {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .param .value.danger {
            color: var(--notion-red);
        }

        .side {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .side.long {
            background-color: var(--notion-green-bg);
            color: var(--notion-green);
        }

        .side.short {
            background-color: var(--notion-red-bg);
            color: var(--notion-red);
        }

        .tiers-visual {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tier-item {
            padding: 1rem;
            border: 2px solid var(--notion-border);
            border-radius: 0.5rem;
            background-color: var(--notion-background-gray);
            transition: all 0.3s;
        }

        .tier-item.current {
            border-color: var(--notion-accent);
            background-color: var(--notion-accent-bg);
        }

        .tier-item.done {
            border-color: var(--notion-green);
            background-color: var(--notion-green-bg);
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .tier-number {
            font-weight: 700;
            color: var(--notion-text);
        }

        .tier-target, .tier-ratio, .tier-progress, .tier-execute-time {
            margin-bottom: 0.75rem;
        }

        .tier-target label, .tier-ratio label, .tier-progress label, .tier-execute-time label {
            font-size: 0.875rem;
            color: var(--notion-text-light);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--notion-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--notion-accent);
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 0.875rem;
            text-align: center;
        }

        .tier-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .chart-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chart-controls {
            display: flex;
            justify-content: flex-end;
        }

        #price-chart {
            width: 100%;
            height: 400px;
        }

        .orders-table {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .risk-analysis {
            margin-top: 2rem;
        }

        .risk-metrics {
            display: grid;
            gap: 1.5rem;
        }

        .risk-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .risk-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .risk-hint {
            cursor: help;
            color: var(--notion-text-light);
            font-style: italic;
        }

        .risk-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .risk-value.danger {
            color: var(--notion-red);
        }

        .risk-value.warning {
            color: var(--notion-yellow);
        }

        .risk-value.safe {
            color: var(--notion-green);
        }

        .risk-bar {
            width: 100%;
            height: 12px;
            background-color: var(--notion-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .risk-fill.danger {
            background-color: var(--notion-red);
        }

        .risk-fill.warning {
            background-color: var(--notion-yellow);
        }

        .risk-fill.safe {
            background-color: var(--notion-green);
        }

        .risk-recommendations {
            margin-top: 1.5rem;
        }

        .recommendations {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .positive {
            color: var(--notion-green);
        }

        .negative {
            color: var(--notion-red);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50vh;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }

            .param-grid {
                grid-template-columns: 1fr;
            }

            .pnl-summary {
                grid-template-columns: 1fr;
            }

            .tiers-visual {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>